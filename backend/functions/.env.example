# Firebase Cloud Functions Environment Configuration
# ===================================================
# Copy this file to .env for local development
# DO NOT commit .env file to version control

# OpenAI API Configuration
# ------------------------
# Required for story generation, TTS, and image generation
# Models used:
# - gpt-4o: Story generation, content filtering, scene extraction
# - gpt-4o-mini-tts: Text-to-speech with voice instructions
# - dall-e-3: Avatar and scene illustration generation
OPENAI_API_KEY=sk-your-openai-api-key-here

# Firebase Service Account (for admin operations)
# ------------------------------------------------
# Path to service account key file for local development
# Generate from Firebase Console > Project Settings > Service Accounts
GOOGLE_APPLICATION_CREDENTIALS=path/to/serviceAccountKey.json

# Firebase Configuration
# ----------------------
# These are automatically set in production by Firebase
# For local testing with emulators, you may override these
FIREBASE_CONFIG={"projectId":"your-project-id"}

# Storage Bucket Names
# --------------------
STORAGE_BUCKET_STORY_ASSETS=story-assets
STORAGE_BUCKET_HERO_AVATARS=hero-avatars
STORAGE_BUCKET_STORY_AUDIO=story-audio
STORAGE_BUCKET_STORY_ILLUSTRATIONS=story-illustrations

# Rate Limiting Configuration
# ---------------------------
# Per-user limits within time window
RATE_LIMIT_STORY_GENERATION=10
RATE_LIMIT_AUDIO_SYNTHESIS=15
RATE_LIMIT_AVATAR_GENERATION=8
RATE_LIMIT_ILLUSTRATION_GENERATION=25
RATE_LIMIT_WINDOW_SECONDS=3600

# Cache Configuration
# -------------------
# TTL in seconds for cached content
CACHE_TTL_STORY_CONTENT=86400      # 24 hours
CACHE_TTL_AUDIO_FILES=604800       # 7 days
CACHE_TTL_AVATAR_IMAGES=604800     # 7 days
CACHE_TTL_ILLUSTRATION_IMAGES=604800  # 7 days
CACHE_TTL_CONTENT_FILTER=7200      # 2 hours

# Content Safety Configuration
# ----------------------------
ENABLE_AI_CONTENT_FILTERING=true
FILTER_STORY_PROMPTS=true
FILTER_STORY_OUTPUT=true
FILTER_SCENE_PROMPTS=true
# Child safety enforcement
ENFORCE_CHILD_COMPANIONSHIP=true   # Never show children alone
MIN_AGE_FOR_CONTENT=3              # Minimum age for content

# Audio Generation Configuration
# ------------------------------
DEFAULT_VOICE=coral
AUDIO_FORMAT=mp3
AUDIO_SPEED=1.0
AUDIO_SAMPLE_RATE=24000

# Image Generation Configuration
# -------------------------------
DEFAULT_IMAGE_SIZE=1024x1024
DEFAULT_IMAGE_QUALITY=hd
IMAGE_FORMAT=png
# Visual consistency using generation IDs
ENABLE_GENERATION_ID_CHAINING=true

# API Response Configuration
# --------------------------
MAX_RESPONSE_SIZE_MB=10
REQUEST_TIMEOUT_SECONDS=30
STREAM_LARGE_RESPONSES=true

# Logging Configuration
# ---------------------
LOG_LEVEL=info                    # debug, info, warn, error
ENABLE_PERFORMANCE_LOGGING=true
ENABLE_API_USAGE_LOGGING=true
ENABLE_COST_TRACKING=true
LOG_OPENAI_REQUESTS=false        # Set to true for debugging

# Development/Testing Configuration
# ----------------------------------
NODE_ENV=development              # development, staging, production
DEBUG_MODE=false
ENABLE_DETAILED_ERRORS=false     # Never true in production
USE_EMULATORS=false               # Set to true for local Firebase emulators

# Security Configuration
# ----------------------
ALLOWED_ORIGINS=http://localhost:3000,https://yourdomain.com
MAX_REQUEST_SIZE_MB=5
ENABLE_REQUEST_VALIDATION=true
REQUIRE_AUTH_TOKEN=true

# Third-party Service URLs (optional)
# ------------------------------------
# Override default OpenAI endpoints if needed
OPENAI_API_BASE_URL=https://api.openai.com/v1
OPENAI_COMPLETIONS_ENDPOINT=/chat/completions
OPENAI_IMAGES_ENDPOINT=/images/generations
OPENAI_AUDIO_ENDPOINT=/audio/speech

# Performance Optimization
# ------------------------
ENABLE_RESPONSE_COMPRESSION=true
PARALLEL_SCENE_GENERATION=true
MAX_PARALLEL_REQUESTS=5
BATCH_PROCESSING_SIZE=10

# Cost Management
# ---------------
MONTHLY_BUDGET_USD=1000
ALERT_THRESHOLD_PERCENTAGE=80
ENABLE_BUDGET_ENFORCEMENT=false   # Stops requests when budget exceeded
TRACK_USER_COSTS=true